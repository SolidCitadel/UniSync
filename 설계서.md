# UniSync ÏãúÏä§ÌÖú ÏÑ§Í≥ÑÏÑú

**Í∞úÎ∞ú ÌòÑÌô©**: Phase 2 ÏßÑÌñâ Ï§ë (Canvas ÎèôÍ∏∞Ìôî Î∞è SQS ÌÜµÌï©)

## Íµ¨ÌòÑ ÌòÑÌô© ÏöîÏïΩ

### ‚úÖ ÏôÑÎ£å
- Í∏∞Î≥∏ Ïù∏ÌîÑÎùº Î∞è ÏÑúÎπÑÏä§ Íµ¨Ï°∞
- **API Gateway (Spring Cloud Gateway + JWT Ïù∏Ï¶ù + Cognito Ïó∞Îèô)**
- Canvas Sync Lambda + SQS ÌÜµÌï©
- Course-ServiceÏùò SQS Íµ¨ÎèÖ Î∞è Assignment Ï≤òÎ¶¨
- Í≥µÏú† Î™®Îìà Í∏∞Î∞ò DTO ÌëúÏ§ÄÌôî
- E2E ÌÜµÌï© ÌÖåÏä§Ìä∏ ÌôòÍ≤Ω

### üöß ÏßÑÌñâ Ï§ë
- User-Service Ïù∏Ï¶ù Î∞è ÌÜ†ÌÅ∞ Í¥ÄÎ¶¨
- Schedule-Service ÏùºÏ†ï ÌÜµÌï©
- Canvas Sync API ÌÜµÌï© (Phase 1: ÏàòÎèô Ìò∏Ï∂ú)

## 1. ÏãúÏä§ÌÖú ÏïÑÌÇ§ÌÖçÏ≤ò

### 1.1 Ï†ÑÏ≤¥ Íµ¨Ï°∞ÎèÑ
```
[Client - React]
       |
       | HTTPS
       |
[API Gateway - ALB + Cognito]
       |
       |--- [User-Service]        --- [MySQL - Users DB]
       |--- [Course-Service]      --- [MySQL - Courses DB]
       |--- [Schedule-Service]    --- [MySQL - Schedules DB]
       |
       |--- [Canvas-Sync-Lambda] --- [SQS]
       |--- [Google-Calendar-Sync-Workflow - Step Functions + Lambda] --- [SQS]
```

### 1.2 ÏÑúÎπÑÏä§ Íµ¨ÏÑ±
- **API Gateway**: ALB + AWS Cognito (Ïù∏Ï¶ù/Ïù∏Í∞Ä)
- **Backend Services**: Spring Boot Í∏∞Î∞ò ÎßàÏù¥ÌÅ¨Î°úÏÑúÎπÑÏä§ (3Í∞ú)
  - User-Service: ÏÇ¨Ïö©Ïûê/Ïù∏Ï¶ù/ÏÜåÏÖú
  - Course-Service: Canvas ÌïôÏóÖ Îç∞Ïù¥ÌÑ∞
  - Schedule-Service: ÏãúÍ∞Ñ Í∏∞Î∞ò ÏùºÏ†ï ÌÜµÌï©
- **Serverless Sync Components**: Lambda
  - Canvas-Sync-Lambda: Canvas API ÎèôÍ∏∞Ìôî (Phase 1: REST API Ìò∏Ï∂ú, Phase 2: EventBridge ÏûêÎèôÌôî)
  - Google-Calendar-Sync-Workflow: Google Calendar ÎèôÍ∏∞Ìôî
- **Data Layer**: MySQL (RDS) - ÏÑúÎπÑÏä§Î≥Ñ DB Î∂ÑÎ¶¨ (3Í∞ú)
- **Message Queue**: AWS SQS
- **Event Bus**: AWS EventBridge

---

## 2. Îç∞Ïù¥ÌÑ∞ Î™®Îç∏

### 2.1 User-Service

#### Users
```sql
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255),
    name VARCHAR(100) NOT NULL,
    canvas_user_id VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email)
);
```

#### Credentials
```sql
CREATE TABLE credentials (
    credential_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    provider ENUM('CANVAS', 'GOOGLE', 'TODOIST') NOT NULL,
    access_token TEXT NOT NULL,
    refresh_token TEXT,
    token_expires_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_provider (user_id, provider),
    INDEX idx_user_id (user_id)
);
```

#### Friendships
```sql
CREATE TABLE friendships (
    friendship_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    friend_id BIGINT NOT NULL,
    status ENUM('PENDING', 'ACCEPTED', 'BLOCKED') DEFAULT 'PENDING',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_friend (user_id, friend_id),
    INDEX idx_user_id (user_id),
    INDEX idx_friend_id (friend_id),
    INDEX idx_status (status),
    CHECK (user_id != friend_id)
);
```

#### Groups
```sql
CREATE TABLE groups (
    group_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    owner_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(user_id) ON DELETE CASCADE,
    INDEX idx_owner_id (owner_id)
);
```

#### Group_Members
```sql
CREATE TABLE group_members (
    member_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    group_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    role ENUM('OWNER', 'ADMIN', 'MEMBER') DEFAULT 'MEMBER',
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (group_id) REFERENCES groups(group_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
    UNIQUE KEY uk_group_user (group_id, user_id),
    INDEX idx_group_id (group_id),
    INDEX idx_user_id (user_id)
);
```

### 2.2 Course-Service

#### Courses
```sql
CREATE TABLE courses (
    course_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    canvas_course_id VARCHAR(100) UNIQUE NOT NULL,
    course_code VARCHAR(50),
    course_name VARCHAR(255) NOT NULL,
    semester VARCHAR(50),
    instructor VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_canvas_course_id (canvas_course_id)
);
```

#### Enrollments
```sql
CREATE TABLE enrollments (
    enrollment_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    course_id BIGINT NOT NULL,
    canvas_enrollment_id VARCHAR(100),
    role ENUM('STUDENT', 'TA', 'INSTRUCTOR') DEFAULT 'STUDENT',
    is_sync_leader BOOLEAN DEFAULT FALSE,
    enrolled_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (course_id) REFERENCES courses(course_id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_course (user_id, course_id),
    INDEX idx_user_id (user_id),
    INDEX idx_course_id (course_id),
    INDEX idx_sync_leader (course_id, is_sync_leader)
);
```

#### Assignments
```sql
CREATE TABLE assignments (
    assignment_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    canvas_assignment_id VARCHAR(100) UNIQUE NOT NULL,
    course_id BIGINT NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    due_date TIMESTAMP,
    points_possible DECIMAL(10, 2),
    submission_types VARCHAR(255),
    canvas_url VARCHAR(512),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (course_id) REFERENCES courses(course_id) ON DELETE CASCADE,
    INDEX idx_canvas_assignment_id (canvas_assignment_id),
    INDEX idx_course_id (course_id),
    INDEX idx_due_date (due_date)
);
```

#### Notices
```sql
CREATE TABLE notices (
    notice_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    canvas_announcement_id VARCHAR(100) UNIQUE NOT NULL,
    course_id BIGINT NOT NULL,
    title VARCHAR(255) NOT NULL,
    message TEXT,
    posted_at TIMESTAMP,
    canvas_url VARCHAR(512),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (course_id) REFERENCES courses(course_id) ON DELETE CASCADE,
    INDEX idx_canvas_announcement_id (canvas_announcement_id),
    INDEX idx_course_id (course_id)
);
```


#### Sync_Status
```sql
CREATE TABLE sync_status (
    sync_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    provider ENUM('CANVAS', 'GOOGLE_CALENDAR', 'TODOIST') NOT NULL,
    last_synced_at TIMESTAMP,
    sync_state ENUM('IDLE', 'IN_PROGRESS', 'FAILED') DEFAULT 'IDLE',
    error_message TEXT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_provider (user_id, provider),
    INDEX idx_user_id (user_id)
);
```

### 2.3 Schedule-Service

**Ï§ëÏöî**: Schedule-ServiceÎäî ÏùºÏ†ï(Schedule)Í≥º Ìï†Ïùº(Todo)ÏùÑ Î™®Îëê Í¥ÄÎ¶¨Ìï©ÎãàÎã§.
- **ÏùºÏ†ï(Schedule)**: ÏãúÍ∞Ñ Îã®ÏúÑ Ïù¥Î≤§Ìä∏ (Ï∫òÎ¶∞Îçî Î∑∞)
- **Ìï†Ïùº(Todo)**: Í∏∞Í∞Ñ Îã®ÏúÑ ÏûëÏóÖ (Ïπ∏Î∞òÎ≥¥Îìú, Í∞ÑÌä∏Ï∞®Ìä∏)
- **Í∑∏Î£π Ï∞∏Ï°∞**: `group_id`Îäî User-ServiceÏùò Groups ÌÖåÏù¥Î∏îÏùÑ FKÎ°ú Ï∞∏Ï°∞

ÏûêÏÑ∏Ìïú Îç∞Ïù¥ÌÑ∞ Î™®Îç∏ Î∞è ÏÑ§Í≥ÑÎäî [ÏùºÏ†ï_Î∞è_Ìï†Ïùº_Í¥ÄÎ¶¨_ÏÑ§Í≥Ñ.md](./ÏùºÏ†ï_Î∞è_Ìï†Ïùº_Í¥ÄÎ¶¨_ÏÑ§Í≥Ñ.md) Ï∞∏Í≥†

#### Schedules (ÏùºÏ†ï)
```sql
CREATE TABLE schedules (
    schedule_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    group_id BIGINT,
    category_id BIGINT NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    location VARCHAR(255),
    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP NOT NULL,
    is_all_day BOOLEAN DEFAULT FALSE,
    status ENUM('TODO', 'IN_PROGRESS', 'DONE') DEFAULT 'TODO',
    recurrence_rule VARCHAR(255),
    source ENUM('USER', 'CANVAS', 'GOOGLE_CALENDAR', 'TODOIST') DEFAULT 'USER',
    source_id VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(category_id) ON DELETE CASCADE,
    FOREIGN KEY (group_id) REFERENCES groups(group_id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_group_id (group_id),
    INDEX idx_category_id (category_id),
    INDEX idx_start_time (start_time),
    INDEX idx_end_time (end_time),
    INDEX idx_status (status),
    CHECK ((user_id IS NOT NULL) OR (group_id IS NOT NULL))
);
```

#### Todos (Ìï†Ïùº)
```sql
CREATE TABLE todos (
    todo_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    group_id BIGINT,
    category_id BIGINT NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    start_date DATE NOT NULL,
    due_date DATE NOT NULL,
    status ENUM('TODO', 'IN_PROGRESS', 'DONE') DEFAULT 'TODO',
    priority ENUM('LOW', 'MEDIUM', 'HIGH', 'URGENT') DEFAULT 'MEDIUM',
    progress_percentage INT DEFAULT 0,
    parent_todo_id BIGINT,
    schedule_id BIGINT,
    is_ai_generated BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(category_id) ON DELETE CASCADE,
    FOREIGN KEY (group_id) REFERENCES groups(group_id) ON DELETE CASCADE,
    FOREIGN KEY (parent_todo_id) REFERENCES todos(todo_id) ON DELETE CASCADE,
    FOREIGN KEY (schedule_id) REFERENCES schedules(schedule_id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_group_id (group_id),
    INDEX idx_category_id (category_id),
    INDEX idx_status (status),
    INDEX idx_priority (priority),
    INDEX idx_due_date (due_date),
    INDEX idx_parent_todo_id (parent_todo_id),
    INDEX idx_schedule_id (schedule_id),
    CHECK ((user_id IS NOT NULL) OR (group_id IS NOT NULL)),
    CHECK (progress_percentage BETWEEN 0 AND 100),
    CHECK (start_date <= due_date)
);
```

#### Categories (Ïπ¥ÌÖåÍ≥†Î¶¨)
```sql
CREATE TABLE categories (
    category_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    group_id BIGINT,
    name VARCHAR(100) NOT NULL,
    color VARCHAR(7) NOT NULL,
    icon VARCHAR(50),
    is_default BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_group_id (group_id),
    UNIQUE KEY uk_user_name (user_id, name),
    CHECK ((user_id IS NOT NULL) OR (group_id IS NOT NULL))
);
```

**Ï∞∏Í≥†**: `group_id`Îäî User-ServiceÏùò Groups ÌÖåÏù¥Î∏îÏùÑ Ï∞∏Ï°∞Ìï©ÎãàÎã§ (FK Ï†úÏïΩÏ°∞Í±¥ÏùÄ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Î†àÎ≤®ÏóêÏÑú Í¥ÄÎ¶¨).

---

## 3. API ÏÑ§Í≥Ñ

### 3.1 User-Service API

#### Ïù∏Ï¶ù Î∞è ÌöåÏõê
- `POST /api/users/register` - ÌöåÏõêÍ∞ÄÏûÖ
- `POST /api/users/login` - Î°úÍ∑∏Ïù∏
- `GET /api/users/profile` - ÌîÑÎ°úÌïÑ Ï°∞Ìöå
- `PUT /api/users/profile` - ÌîÑÎ°úÌïÑ ÏàòÏ†ï
- `DELETE /api/users/account` - Í≥ÑÏ†ï ÏÇ≠Ï†ú

#### Ïô∏Î∂Ä Í≥ÑÏ†ï Ïó∞Îèô
- `POST /api/users/credentials/canvas` - Canvas API ÌÜ†ÌÅ∞ Ï†ÄÏû•
  - Request Body: `{ "canvasToken": "string", "canvasUrl": "https://canvas.example.com" }`
- `POST /api/users/credentials/google` - Google Í≥ÑÏ†ï Ïó∞Îèô (OAuth2)
- `POST /api/users/credentials/todoist` - Todoist Í≥ÑÏ†ï Ïó∞Îèô (OAuth2)
- `GET /api/users/credentials` - Ïó∞ÎèôÎêú Í≥ÑÏ†ï Î™©Î°ù
- `DELETE /api/users/credentials/{provider}` - Í≥ÑÏ†ï Ïó∞Îèô Ìï¥Ï†ú

### 3.2 Course-Service API

#### ÏàòÍ∞ï Í≥ºÎ™©
- `GET /api/courses` - ÎÇ¥ ÏàòÍ∞ï Í≥ºÎ™© Î™©Î°ù
- `GET /api/courses/{courseId}` - Í≥ºÎ™© ÏÉÅÏÑ∏ Ï†ïÎ≥¥
- `POST /api/courses/sync` - CanvasÏóêÏÑú Í≥ºÎ™© ÎèôÍ∏∞Ìôî
- `GET /api/courses/{courseId}/students` - Í≥ºÎ™© ÏàòÍ∞ïÏÉù Î™©Î°ù

### 3.3 Course-Service API

#### Í≥ºÏ†ú Í¥ÄÎ¶¨
- `GET /api/v1/assignments` - Í≥ºÏ†ú Î™©Î°ù (ÌïÑÌÑ∞ÎßÅ: Í≥ºÎ™©, ÎßàÍ∞êÏùº, ÏÉÅÌÉú)
- `GET /api/v1/assignments/{assignmentId}` - Í≥ºÏ†ú ÏÉÅÏÑ∏

#### ÎèôÍ∏∞Ìôî
- `POST /api/v1/sync/canvas/trigger` - Canvas ÏàòÎèô ÎèôÍ∏∞Ìôî Ìä∏Î¶¨Í±∞
- `GET /api/v1/sync/status` - ÎèôÍ∏∞Ìôî ÏÉÅÌÉú Ï°∞Ìöå

#### Í≥µÏßÄÏÇ¨Ìï≠
- `GET /api/v1/notices` - Í≥µÏßÄÏÇ¨Ìï≠ Î™©Î°ù
- `GET /api/v1/notices/{noticeId}` - Í≥µÏßÄ ÏÉÅÏÑ∏

### 3.4 Schedule-Service API

#### ÏùºÏ†ï(Schedule) Í¥ÄÎ¶¨
- `GET /api/v1/schedules` - ÏùºÏ†ï Î™©Î°ù (ÎÇ†Ïßú Î≤îÏúÑ, Ïπ¥ÌÖåÍ≥†Î¶¨, Í∑∏Î£π ÌïÑÌÑ∞)
- `POST /api/v1/schedules` - ÏùºÏ†ï ÏÉùÏÑ±
- `PUT /api/v1/schedules/{scheduleId}` - ÏùºÏ†ï ÏàòÏ†ï
- `DELETE /api/v1/schedules/{scheduleId}` - ÏùºÏ†ï ÏÇ≠Ï†ú
- `PATCH /api/v1/schedules/{scheduleId}/status` - ÏùºÏ†ï ÏÉÅÌÉú Î≥ÄÍ≤Ω
- `POST /api/v1/schedules/{scheduleId}/convert-to-todo` - ÏùºÏ†ï‚ÜíÌï†Ïùº Î≥ÄÌôò

#### Ìï†Ïùº(Todo) Í¥ÄÎ¶¨
- `GET /api/v1/todos` - Ìï†Ïùº Î™©Î°ù (ÎÇ†Ïßú Î≤îÏúÑ, Ïπ¥ÌÖåÍ≥†Î¶¨, Í∑∏Î£π, ÏÉÅÌÉú, Ïö∞ÏÑ†ÏàúÏúÑ ÌïÑÌÑ∞)
- `POST /api/v1/todos` - Ìï†Ïùº ÏÉùÏÑ±
- `PUT /api/v1/todos/{todoId}` - Ìï†Ïùº ÏàòÏ†ï
- `DELETE /api/v1/todos/{todoId}` - Ìï†Ïùº ÏÇ≠Ï†ú
- `PATCH /api/v1/todos/{todoId}/status` - Ìï†Ïùº ÏÉÅÌÉú Î≥ÄÍ≤Ω
- `PATCH /api/v1/todos/{todoId}/progress` - ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
- `GET /api/v1/todos/{todoId}/subtasks` - ÏÑúÎ∏åÌÉúÏä§ÌÅ¨ Î™©Î°ù
- `POST /api/v1/todos/{todoId}/subtasks` - ÏÑúÎ∏åÌÉúÏä§ÌÅ¨ ÏÉùÏÑ±

#### Ïπ¥ÌÖåÍ≥†Î¶¨ Í¥ÄÎ¶¨
- `GET /api/v1/categories` - Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù (Í∞úÏù∏ + ÎÇ¥Í∞Ä ÏÜçÌïú Í∑∏Î£π Ïπ¥ÌÖåÍ≥†Î¶¨)
  - Query Params: `groupId` (ÏÑ†ÌÉù)
- `POST /api/v1/categories` - Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉùÏÑ±
  - Request Body: `{ "name": "Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§", "color": "#FF5733", "icon": "book", "groupId": null }`
- `PUT /api/v1/categories/{categoryId}` - Ïπ¥ÌÖåÍ≥†Î¶¨ ÏàòÏ†ï
- `DELETE /api/v1/categories/{categoryId}` - Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÇ≠Ï†ú

#### Í≥µÍ∞ï Ï∞æÍ∏∞
- `POST /api/v1/schedules/find-free-slots` - Ïó¨Îü¨ ÏÇ¨Ïö©Ïûê Í≥µÍ∞ï ÏãúÍ∞Ñ Í≥ÑÏÇ∞
  - Request Body: `{ userIds: [1, 2, 3], startDate, endDate, minDuration }`
  - Response: Í≤πÏπòÏßÄ ÏïäÎäî ÏãúÍ∞ÑÎåÄ Î™©Î°ù


---

## 4. ÏÑúÎπÑÏä§ Í∞Ñ ÌÜµÏã†

### 4.1 ÎèôÍ∏∞ ÌÜµÏã† (REST API)
- API GatewayÎ•º ÌÜµÌïú ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏöîÏ≤≠ÏùÄ ÎèôÍ∏∞ Ï≤òÎ¶¨
- ÏÑúÎπÑÏä§ Í∞Ñ ÏßÅÏ†ë Ìò∏Ï∂úÏùÄ ÏµúÏÜåÌôî
- ÌïÑÏöî Ïãú Service Discovery (Spring Cloud) ÎòêÎäî ALB ÌôúÏö©

### 4.2 ÎπÑÎèôÍ∏∞ ÌÜµÏã† (Event-Driven)

#### SQS ÌÅê Íµ¨ÏÑ±
1. **assignment-events-queue**
   - Producer: Canvas-Sync-Lambda
   - Consumer: Course-Service, Schedule-Service
   - Message: ÏÉàÎ°úÏö¥ Í≥ºÏ†ú Ï†ïÎ≥¥

2. **task-creation-queue**
   - Producer: Canvas-Sync-Lambda
   - Consumer: Schedule-Service
   - Message: Í≥ºÏ†ú Í∏∞Î∞ò Ìï†Ïùº(Todo) ÏÉùÏÑ± ÏöîÏ≤≠

3. **submission-events-queue**
   - Producer: Canvas-Sync-Lambda
   - Consumer: Schedule-Service
   - Message: Í≥ºÏ†ú Ï†úÏ∂úÎ¨º Ï†ïÎ≥¥

4. **calendar-events-queue**
   - Producer: Google-Calendar-Sync-Lambda
   - Consumer: Schedule-Service
   - Message: Google Calendar ÎèôÍ∏∞Ìôî Ïù¥Î≤§Ìä∏

#### EventBridge Ïù¥Î≤§Ìä∏
- `AssignmentCreated` - ÏÉà Í≥ºÏ†ú ÏÉùÏÑ± Ïãú
- `AssignmentUpdated` - Í≥ºÏ†ú ÏàòÏ†ï Ïãú
- `TaskCompleted` - Task ÏôÑÎ£å Ïãú
- `SyncFailed` - ÎèôÍ∏∞Ìôî Ïã§Ìå® Ïãú

---

## 5. ÎèôÍ∏∞Ìôî Ï†ÑÎûµ

### 5.1 Canvas API ÎèôÍ∏∞Ìôî

#### Ìè¥ÎßÅ Ï£ºÍ∏∞
- **Ïã§ÏãúÍ∞Ñ Î™®Îìú**: 5Î∂ÑÎßàÎã§ Ìè¥ÎßÅ (EventBridge Scheduler)
- **Ï†àÏ†Ñ Î™®Îìú**: ÏÇ¨Ïö©Ïûê ÎπÑÌôúÏÑ± Ïãú 30Î∂ÑÎßàÎã§
- **ÏàòÎèô Ìä∏Î¶¨Í±∞**: ÏÇ¨Ïö©Ïûê ÏöîÏ≤≠ Ïãú Ï¶âÏãú

#### Leader ÏÑ†Ï∂ú Î∞©Ïãù
- Í≥ºÎ™©Îãπ Ìïú Î™ÖÏùò LeaderÎßå Canvas API Ìò∏Ï∂ú (API ÎπÑÏö© Ï†àÍ∞ê)
- Course-ServiceÍ∞Ä Enrollment ÌÖåÏù¥Î∏îÏóêÏÑú `is_sync_leader` Í¥ÄÎ¶¨
- Leader ÏÑ†Ï∂ú Ï°∞Í±¥:
  1. Ìï¥Îãπ Í≥ºÎ™©Ïùò Ï≤´ Î≤àÏß∏ Ïó∞Îèô ÏÇ¨Ïö©Ïûê
  2. Í∏∞Ï°¥ LeaderÍ∞Ä Ïó∞Îèô Ìï¥Ï†ú Ïãú Îã§Ïùå ÏÇ¨Ïö©ÏûêÎ°ú ÏûêÎèô Ïù¥Í¥Ä
- LeaderÍ∞Ä Ï°∞ÌöåÌïú Îç∞Ïù¥ÌÑ∞Îäî Î™®Îì† ÏàòÍ∞ïÏÉùÏóêÍ≤å Í≥µÏú†

#### Î≥ÄÍ≤Ω Í∞êÏßÄ
- Canvas APIÏùò `updated_at` ÌïÑÎìúÎ°ú Ï¶ùÎ∂Ñ ÎèôÍ∏∞Ìôî
- ÎßàÏßÄÎßâ ÎèôÍ∏∞Ìôî ÏãúÍ∞Å Ïù¥ÌõÑ Î≥ÄÍ≤ΩÎêú Ìï≠Î™©Îßå Ï°∞Ìöå
- Step FunctionsÏóêÏÑú Ï≤òÎ¶¨:
  1. Canvas API Ìò∏Ï∂ú
  2. Î≥ÄÍ≤Ω ÏÇ¨Ìï≠ ÎπÑÍµê
  3. Î≥ÄÍ≤ΩÎêú Ìï≠Î™©Îßå SQSÎ°ú Ï†ÑÏÜ°

### 5.2 Ïô∏Î∂Ä ÏÑúÎπÑÏä§ ÏñëÎ∞©Ìñ• ÎèôÍ∏∞Ìôî

#### Google Calendar
- **UniSync ‚Üí Google**: Í≥ºÏ†ú/ÏùºÏ†ï ÏÉùÏÑ± Ïãú Google Calendar API Ìò∏Ï∂ú
- **Google ‚Üí UniSync**: Google Calendar Webhook Íµ¨ÎèÖ
  - Push Notification ÏàòÏã†
  - Î≥ÄÍ≤Ω ÏÇ¨Ìï≠ Schedule-ServiceÏóê Î∞òÏòÅ

#### Todoist
- **UniSync ‚Üí Todoist**: Task ÏÉùÏÑ±/ÏàòÏ†ï Ïãú Todoist API Ìò∏Ï∂ú
- **Todoist ‚Üí UniSync**: Webhook Íµ¨ÎèÖ ÎòêÎäî Ï£ºÍ∏∞Ï†Å Ìè¥ÎßÅ

#### Ï∂©Îèå Ìï¥Í≤∞ Ï†ïÏ±Ö
- **Last-Write-Wins**: ÏµúÏã† ÏàòÏ†ï ÏãúÍ∞Å Í∏∞Ï§Ä
- **User Preference**: ÏÑ§Ï†ïÏóêÏÑú Ïö∞ÏÑ† ÏÜåÏä§ ÏßÄÏ†ï (UniSync Ïö∞ÏÑ† ÎòêÎäî Ïô∏Î∂Ä ÏÑúÎπÑÏä§ Ïö∞ÏÑ†)
- **Manual Resolution**: Ï∂©Îèå Î∞úÏÉù Ïãú ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏÑ†ÌÉù UI Ï†úÍ≥µ

---

## 6. Sync-Workflow ÏÑ§Í≥Ñ (Step Functions)

### 6.1 Canvas Sync Workflow
```
Start
  ‚Üì
Get All Active Courses with Sync Leader
  ‚Üì
For Each Course (Leader ÌÜ†ÌÅ∞ ÏÇ¨Ïö©)
  ‚Üì
  Canvas-Sync-Lambda: Fetch Canvas Assignments, Announcements & Submissions
  ‚Üì
  Compare with DB (check updated_at)
  ‚Üì
  New Assignment Detected?
    ‚Üì Yes
    1. Send to SQS (assignment-events-queue)
       ‚Üí Course-Service: Assignment Ï†ÄÏû•
       ‚Üí Schedule-Service: ÏùºÏ†ï(Schedule) ÏÉùÏÑ±

    2. Send to SQS (task-creation-queue)
       ‚Üí Schedule-Service: Ìï†Ïùº(Todo) ÏÉùÏÑ± (Í≥ºÏ†ú Í∏∞Î∞ò)
  ‚Üì
  Submission Detected?
    ‚Üì Yes
    Send to SQS (submission-events-queue)
    ‚Üí Schedule-Service: ÏùºÏ†ï/Ìï†Ïùº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
  ‚Üì
Continue to Next Course
  ‚Üì
End

---
ÌïµÏã¨ ÌîåÎ°úÏö∞ (Phase 1):
Canvas Í≥ºÏ†ú ‚Üí ÏùºÏ†ï(Schedule) + Ìï†Ïùº(Todo) ÏûêÎèô ÏÉùÏÑ±

Phase 3 (Ìñ•ÌõÑ): LLM Î∂ÑÏÑù ‚Üí ÏÑúÎ∏åÌÉúÏä§ÌÅ¨ ÏûêÎèô ÏÉùÏÑ± + Ï†úÏ∂úÎ¨º Í≤ÄÏ¶ù
```

### 6.2 External Sync Workflow (Google Calendar, Todoist)
```
Start
  ‚Üì
Receive Event from SQS (external-sync-queue)
  ‚Üì
Lambda: Call External API (create/update/delete)
  ‚Üì
Success?
  ‚Üì Yes
  Update Sync Status
  ‚Üì No
  Retry (ÏµúÎåÄ 3Ìöå)
  ‚Üì
  Still Failed? ‚Üí Send Alert
  ‚Üì
End
```

---

## 7. LLM ÏÑúÎπÑÏä§ ÏÑ§Í≥Ñ (Phase 3 - Ìñ•ÌõÑ Íµ¨ÌòÑ)

**ÌòÑÏû¨ ÏÉÅÌÉú**: ÎØ∏Íµ¨ÌòÑ. Phase 1ÏóêÏÑúÎäî Í≥ºÏ†úÎ•º Í∏∞Î∞òÏúºÎ°ú Îã®Ïàú Ìï†Ïùº(Todo) ÏÉùÏÑ±.

### 7.1 Lambda Ìï®Ïàò Íµ¨ÏÑ± (Í≥ÑÌöç)
- **Runtime**: Python 3.11
- **Timeout**: 30Ï¥à
- **Memory**: 512MB

### 7.2 Í∏∞Îä• (Í≥ÑÌöç)

#### 1) Ìï†Ïùº Î∞è ÏÑúÎ∏åÌÉúÏä§ÌÅ¨ ÏÉùÏÑ± (AI Í∏∞Î∞ò)
- **Input**: Í≥ºÏ†ú ÏÑ§Î™Ö (ÌÖçÏä§Ìä∏), Í≥ºÏ†ú ÎßàÍ∞êÏùº
- **Output**: JSON ÌòïÌÉúÏùò Ìï†Ïùº(Todo) Î∞è ÏÑúÎ∏åÌÉúÏä§ÌÅ¨ Î™©Î°ù (title, description, start_date, due_date, priority)
- SQS: `llm-analysis-queue`Î°ú Ï†ÑÏÜ° ‚Üí LLM Lambda Î∂ÑÏÑù ‚Üí Schedule-ServiceÍ∞Ä ÏÑúÎ∏åÌÉúÏä§ÌÅ¨ ÏÉùÏÑ±

#### 2) Ï†úÏ∂úÎ¨º Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
- **Input**: Í≥ºÏ†ú ÏÑ§Î™Ö + Ï†úÏ∂úÎ¨º Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ (ÌååÏùºÎ™Ö, ÌôïÏû•Ïûê, ÌååÏùº ÌÅ¨Í∏∞)
- **Output**: Ïú†Ìö®ÏÑ± Í≤ÄÏ¶ù Í≤∞Í≥º (is_valid, issues, warnings)
- Í≤ÄÏ¶ù Ìï≠Î™©: ÌååÏùº ÌòïÏãù, ÌååÏùºÎ™Ö Í∑úÏπô, Ï†úÏ∂úÎ¨º Í∞úÏàò

### 7.3 ÎπÑÏö© Í¥ÄÎ¶¨ (Í≥ÑÌöç)
- ÏÇ¨Ïö©ÏûêÎãπ Ïõî LLM API Ìò∏Ï∂ú Ï†úÌïú
- Ï∫êÏã±: ÎèôÏùº Í≥ºÏ†úÏóê ÎåÄÌïú Î∂ÑÏÑù Í≤∞Í≥º Ï∫êÏãú

---

## 8. Î≥¥Ïïà ÏÑ§Í≥Ñ

### 8.1 Ïù∏Ï¶ù/Ïù∏Í∞Ä
- **AWS Cognito**: ÏÇ¨Ïö©Ïûê Ïù∏Ï¶ù Î∞è JWT Î∞úÍ∏â
- **JWT Í≤ÄÏ¶ù**: API GatewayÏóêÏÑú ÏûêÎèô Í≤ÄÏ¶ù
- **Role-Based Access Control**:
  - Î≥∏Ïù∏ Îç∞Ïù¥ÌÑ∞Îßå Ï†ëÍ∑º Í∞ÄÎä•
  - ÏπúÍµ¨ Îç∞Ïù¥ÌÑ∞Îäî Í≥µÍ∞ï Ï∞æÍ∏∞ Îì± Ï†úÌïúÏ†Å Ï†ëÍ∑º

### 8.2 Îç∞Ïù¥ÌÑ∞ ÏïîÌò∏Ìôî
- **Ï†ÑÏÜ° Ï§ë**: HTTPS (TLS 1.2+)
- **Ï†ÄÏû• Ï§ë**:
  - RDS ÏïîÌò∏Ìôî ÌôúÏÑ±Ìôî
  - access_token, refresh_tokenÏùÄ AES-256 ÏïîÌò∏Ìôî ÌõÑ Ï†ÄÏû•

### 8.3 API ÌÇ§ Í¥ÄÎ¶¨
- **AWS Secrets Manager**:
  - Canvas API Token
  - Google OAuth Client Secret
  - Todoist API Key
- Lambda Î∞è Spring Boot ÏÑúÎπÑÏä§ÏóêÏÑú Îü∞ÌÉÄÏûÑ Ïãú Ï°∞Ìöå

### 8.4 Rate Limiting
- API GatewayÏóêÏÑú ÏÇ¨Ïö©ÏûêÎ≥Ñ Rate Limit ÏÑ§Ï†ï
  - ÏùºÎ∞ò API: 100 req/min
  - Canvas Sync API: 10 req/min

---

## 9. Î∞∞Ìè¨ ÏïÑÌÇ§ÌÖçÏ≤ò

### 9.1 AWS Ïù∏ÌîÑÎùº

#### Compute
- **ECS Fargate**: Spring Boot ÎßàÏù¥ÌÅ¨Î°úÏÑúÎπÑÏä§ Ïª®ÌÖåÏù¥ÎÑà Ïã§Ìñâ
  - User-Service: 2 tasks (CPU: 0.5 vCPU, Memory: 1GB)
  - Course-Service: 2 tasks
  - Sync-Service: 2 tasks
  - Schedule-Service: 2 tasks
  - Social-Service: 1 task
- **Lambda**: Sync-Workflow, LLM Service

#### Data
- **RDS MySQL**: ÏÑúÎπÑÏä§Î≥Ñ DB (Multi-AZ Íµ¨ÏÑ±)
- **SQS**: Î©îÏãúÏßÄ ÌÅê
- **EventBridge**: Ïù¥Î≤§Ìä∏ Ïä§ÏºÄÏ§ÑÎßÅ

#### Networking
- **ALB**: Î°úÎìú Î∞∏Îü∞Ïã± Î∞è HTTPS Ï¢ÖÎ£å
- **VPC**: Private Subnet (ECS, RDS), Public Subnet (ALB)
- **Security Groups**: ÏÑúÎπÑÏä§Î≥Ñ ÏµúÏÜå Í∂åÌïú ÏõêÏπô

#### Monitoring
- **CloudWatch**: Î°úÍ∑∏ ÏàòÏßë, Î©îÌä∏Î¶≠ Î™®ÎãàÌÑ∞ÎßÅ
- **CloudWatch Alarms**: ÏóêÎü¨Ïú®, ÏùëÎãµ ÏãúÍ∞Ñ ÏïåÎ¶º

### 9.2 CI/CD Pipeline (GitHub Actions)

```yaml
# .github/workflows/deploy.yml
on:
  push:
    branches: [main]

jobs:
  build:
    - Checkout code
    - Build Spring Boot JAR
    - Build Docker image
    - Push to ECR

  deploy:
    - Update ECS Task Definition
    - Deploy to ECS Fargate
    - Run health check
    - Rollback if failed
```

---

## 10. Í∞úÎ∞ú ÌôòÍ≤Ω ÏÑ§Ï†ï (docker-compose + LocalStack)

### 10.1 Ï£ºÏöî Íµ¨ÏÑ±
- **LocalStack**: SQS, Lambda, EventBridge, Cognito ÏóêÎÆ¨Î†àÏù¥ÏÖò (Ìè¨Ìä∏: 4566)
- **MySQL**: ÏÑúÎπÑÏä§Î≥Ñ DB (Ìè¨Ìä∏: 3306)
- **Spring Boot Services**: User(8081), Course(8082), Schedule(8083)
- ÏûêÏÑ∏Ìïú Íµ¨ÏÑ±ÏùÄ [docker-compose.yml](./docker-compose.yml) Ï∞∏Í≥†

### 10.2 Î°úÏª¨ Í∞úÎ∞ú ÌîåÎ°úÏö∞
1. `docker-compose up` - Ï†ÑÏ≤¥ ÌôòÍ≤Ω Ïã§Ìñâ
2. LocalStackÏóêÏÑú SQS ÌÅê, EventBridge Í∑úÏπô ÏûêÎèô ÏÉùÏÑ±
3. MySQL Ïä§ÌÇ§Îßà ÏûêÎèô ÏÉùÏÑ± (Flyway/Liquibase)
4. Swagger UIÏóêÏÑú API ÌÖåÏä§Ìä∏ (http://localhost:808x/swagger-ui.html)

---

## 11. Í∏∞Ïà† Ïä§ÌÉù Ï†ïÎ¶¨

### Frontend
- **React** 18+
- **TypeScript**
- **React Query** (ÏÑúÎ≤Ñ ÏÉÅÌÉú Í¥ÄÎ¶¨)
- **Zustand** (ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉÅÌÉú Í¥ÄÎ¶¨)
- **TailwindCSS** (Ïä§ÌÉÄÏùºÎßÅ)
- **FullCalendar** (Ï∫òÎ¶∞Îçî UI)

### Backend
- **Spring Boot** 3.x
- **Spring Cloud** (Service Discovery)
- **Spring Data JPA**
- **Swagger/OpenAPI** 3.0
- **AWS SDK for Java** 2.x

### Infrastructure
- **Docker** & **docker-compose**
- **LocalStack** (Î°úÏª¨ AWS ÏóêÎÆ¨Î†àÏù¥ÏÖò)
- **MySQL** 8.0
- **AWS**: ECS, Fargate, Lambda, SQS, EventBridge, RDS, ALB, Cognito, Secrets Manager

### DevOps
- **GitHub Actions** (CI/CD)
- **AWS ECR** (Ïª®ÌÖåÏù¥ÎÑà Î†àÏßÄÏä§Ìä∏Î¶¨)
- **CloudWatch** (Î™®ÎãàÌÑ∞ÎßÅ)

---

## 12. Í∞úÎ∞ú Îã®Í≥ÑÎ≥Ñ Ïö∞ÏÑ†ÏàúÏúÑ

**Phase 1** (ÏôÑÎ£å): User-Service, Course-Service Í∏∞Î≥∏ Íµ¨Ï°∞
**Phase 2** (ÏßÑÌñâ Ï§ë): Canvas ÎèôÍ∏∞Ìôî, SQS Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
**Phase 3** (ÏòàÏ†ï): LLM Lambda, Task ÏûêÎèô ÏÉùÏÑ±
**Phase 4** (ÏòàÏ†ï): ÏÜåÏÖú Í∏∞Îä•, Í≥µÍ∞ï Ï∞æÍ∏∞
**Phase 5** (ÏòàÏ†ï): Ïô∏Î∂Ä ÏÑúÎπÑÏä§ Ïó∞Îèô, Í≥†ÎèÑÌôî

ÌòÑÏû¨ ÏÉÅÌÉúÎäî [CLAUDE.md](./CLAUDE.md#ÌîÑÎ°úÏ†ùÌä∏-Í∞úÏöî) Ï∞∏Í≥†
